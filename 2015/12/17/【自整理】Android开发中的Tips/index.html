<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 【自整理】Android开发中的Tips · IM XIE</title><meta name="description" content="【自整理】Android开发中的Tips - 谢三弟"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://imxie.cc/atom.xml" title="IM XIE"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/xcc3641" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/WebLab/" target="_self" class="nav-list-link">WEBLAB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">【自整理】Android开发中的Tips</h1><div class="post-info">2015年12月17日</div><div class="post-content"><p><img src="http://xcc3641.qiniudn.com/blogandroid.jpg" alt=""></p>
<p>本文是为了记录自己开发过程中遇到的坑和写过的可复用代码块。<br>updata: 2015.12.17</p>
<a id="more"></a>
<h2 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h2><h3 id="双击退出"><a href="#双击退出" class="headerlink" title="双击退出"></a>双击退出</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public boolean onKeyDown(int keyCode, KeyEvent event) &#123;</div><div class="line">	if (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; event.getRepeatCount() == 0) &#123;</div><div class="line">		if ((System.currentTimeMillis() - exitTime) &gt; 2000) &#123;</div><div class="line">			Toast.makeText(this, &quot;再按一次退出程序&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">			exitTime = System.currentTimeMillis();</div><div class="line">           	&#125; </div><div class="line">		else &#123;</div><div class="line">            finish();</div><div class="line">			&#125;</div><div class="line">        &#125;</div><div class="line">	return false;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="获取时间"><a href="#获取时间" class="headerlink" title="获取时间"></a>获取时间</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Calendar c = Calendar.getInstance();</div><div class="line">c.add(Calendar.DATE, -1);//获取昨天</div><div class="line">time = new SimpleDateFormat(&quot;yyyyMMdd&quot;).format(c.getTime());</div></pre></td></tr></table></figure>
<p>[^ 最开始的时候自己不知道Calendar有这个方法，自己写获取昨天实在麻烦，因为需要考虑跨月和跨年]</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 判断当前日期是星期几</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> pTime 修要判断的时间</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> dayForWeek 判断结果</span></div><div class="line"><span class="comment">     * <span class="doctag">@Exception</span> 发生异常</span></div><div class="line"><span class="comment">     */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dayForWeek</span><span class="params">(String pTime)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</div><div class="line">        Calendar c = Calendar.getInstance();</div><div class="line">        c.setTime(format.parse(pTime));</div><div class="line">        <span class="keyword">int</span> dayForWeek = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(c.get(Calendar.DAY_OF_WEEK) == <span class="number">1</span>)&#123;</div><div class="line">            dayForWeek = <span class="number">7</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            dayForWeek = c.get(Calendar.DAY_OF_WEEK) - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> dayForWeek;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="检测是否已经连接到网络"><a href="#检测是否已经连接到网络" class="headerlink" title="检测是否已经连接到网络"></a>检测是否已经连接到网络</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//需要权限</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;</div></pre></td></tr></table></figure>
<p>只关注是否联网：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public boolean isNetworkConnected(Context context) &#123;</div><div class="line">	if (context != null) &#123;</div><div class="line">		ConnectivityManager mConnectivityManager = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);</div><div class="line">		NetworkInfo mNetworkInfo = mConnectivityManager.getActiveNetworkInfo();</div><div class="line">	if (mNetworkInfo != null) &#123;</div><div class="line">		return mNetworkInfo.isAvailable();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>WIFI或者Internet：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">ConnectivityManager con=(ConnectivityManager)getSystemService(Activity.CONNECTIVITY_SERVICE);</div><div class="line">boolean wifi=con.getNetworkInfo(ConnectivityManager.TYPE_WIFI).isConnectedOrConnecting();</div><div class="line">boolean internet=con.getNetworkInfo(ConnectivityManager.TYPE_MOBILE).isConnectedOrConnecting();</div></pre></td></tr></table></figure></p>
<h3 id="发送短信"><a href="#发送短信" class="headerlink" title="发送短信"></a>发送短信</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public static void sendSms(Context context, String phoneNumber,</div><div class="line">            String content) &#123;</div><div class="line">        Uri uri = Uri.parse(&quot;smsto:&quot;</div><div class="line">                + (TextUtils.isEmpty(phoneNumber) ? &quot;&quot; : phoneNumber));</div><div class="line">        Intent intent = new Intent(Intent.ACTION_SENDTO, uri);</div><div class="line">        intent.putExtra(&quot;sms_body&quot;, TextUtils.isEmpty(content) ? &quot;&quot; : content);</div><div class="line">        context.startActivity(intent);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="唤醒屏幕并解锁"><a href="#唤醒屏幕并解锁" class="headerlink" title="唤醒屏幕并解锁"></a>唤醒屏幕并解锁</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public static void wakeUpAndUnlock(Context context)&#123;  </div><div class="line">        KeyguardManager km= (KeyguardManager) context.getSystemService(Context.KEYGUARD_SERVICE);  </div><div class="line">        KeyguardManager.KeyguardLock kl = km.newKeyguardLock(&quot;unLock&quot;);  </div><div class="line">        //解锁</div><div class="line">        kl.disableKeyguard(); </div><div class="line">        //获取电源管理器对象</div><div class="line">        PowerManager pm=(PowerManager) context.getSystemService(Context.POWER_SERVICE);  </div><div class="line">        //获取PowerManager.WakeLock对象,后面的参数|表示同时传入两个值,最后的是LogCat里用的Tag  </div><div class="line">        PowerManager.WakeLock wl = pm.newWakeLock(PowerManager.ACQUIRE_CAUSES_WAKEUP | PowerManager.SCREEN_DIM_WAKE_LOCK,&quot;bright&quot;);  </div><div class="line">        //点亮屏幕  </div><div class="line">        wl.acquire();  </div><div class="line">        //释放  </div><div class="line">        wl.release();  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>需要添加权限：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.DISABLE_KEYGUARD&quot; /&gt;</div></pre></td></tr></table></figure></p>
<h3 id="判断当前设备是否为手机"><a href="#判断当前设备是否为手机" class="headerlink" title="判断当前设备是否为手机"></a>判断当前设备是否为手机</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public static boolean isPhone(Context context) &#123;</div><div class="line">       TelephonyManager telephony = (TelephonyManager) context</div><div class="line">               .getSystemService(Context.TELEPHONY_SERVICE);</div><div class="line">       if (telephony.getPhoneType() == TelephonyManager.PHONE_TYPE_NONE) &#123;</div><div class="line">           return false;</div><div class="line">       &#125; else &#123;</div><div class="line">           return true;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="获取当前设备的IMEI，与上面的isPhone-一起使用"><a href="#获取当前设备的IMEI，与上面的isPhone-一起使用" class="headerlink" title="获取当前设备的IMEI，与上面的isPhone()一起使用"></a>获取当前设备的IMEI，与上面的isPhone()一起使用</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@TargetApi(Build.VERSION_CODES.CUPCAKE)</div><div class="line">    public static String getDeviceIMEI(Context context) &#123;</div><div class="line">        String deviceId;</div><div class="line">        if (isPhone(context)) &#123;</div><div class="line">            TelephonyManager telephony = (TelephonyManager) context</div><div class="line">                    .getSystemService(Context.TELEPHONY_SERVICE);</div><div class="line">            deviceId = telephony.getDeviceId();</div><div class="line">        &#125; else &#123;</div><div class="line">            deviceId = Settings.Secure.getString(context.getContentResolver(),</div><div class="line">                    Settings.Secure.ANDROID_ID);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        return deviceId;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="获取当前程序的版本号"><a href="#获取当前程序的版本号" class="headerlink" title="获取当前程序的版本号"></a>获取当前程序的版本号</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public static String getAppVersion(Context context) &#123;</div><div class="line">        String version = &quot;0&quot;;</div><div class="line">        try &#123;</div><div class="line">            version = context.getPackageManager().getPackageInfo(</div><div class="line">                    context.getPackageName(), 0).versionName;</div><div class="line">        &#125; catch (PackageManager.NameNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        return version;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="获取当前设备宽高，单位px"><a href="#获取当前设备宽高，单位px" class="headerlink" title="获取当前设备宽高，单位px"></a>获取当前设备宽高，单位px</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public static int getDeviceWidth(Context context) &#123;</div><div class="line">      WindowManager manager = (WindowManager) context</div><div class="line">              .getSystemService(Context.WINDOW_SERVICE);</div><div class="line">      return manager.getDefaultDisplay().getWidth();</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  public static int getDeviceHeight(Context context) &#123;</div><div class="line">      WindowManager manager = (WindowManager) context</div><div class="line">              .getSystemService(Context.WINDOW_SERVICE);</div><div class="line">      return manager.getDefaultDisplay().getHeight();</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="Retrofit-2-0"><a href="#Retrofit-2-0" class="headerlink" title="Retrofit 2.0"></a>Retrofit 2.0</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//baseUrl=&quot;http://example/SaveImg/&quot;</div><div class="line">public interface imgApi &#123;</div><div class="line"></div><div class="line">	@GET(&quot;DouBanGirl&quot;)</div><div class="line">	Call&lt;Img&gt; getImg(@Query(&quot;date&quot;) String date);</div><div class="line">&#125;</div><div class="line">//假设传入date=20150101</div></pre></td></tr></table></figure>
<p>最后实际访问的地址是：<a href="http://example/SaveImg/DouBanGirl?date=20150101" target="_blank" rel="external">http://example/SaveImg/DouBanGirl?date=20150101</a><br>这个地址拼接最开始的时候坑了自己很久，官方也没有仔细讲明白。</p>
<h3 id="Jsoup"><a href="#Jsoup" class="headerlink" title="Jsoup"></a>Jsoup</h3><p>自己还是习惯Python里的正则或者bs4进行匹配，Java里目前只接触了Jsoup，每次都要去查阅用法。最近查看Jsoup源码的时候好像发现Jsoup也是可以用正则匹配的。<br>顺便说下当发现Android.text下的<strong>HTML.fromHtml()</strong>方法的时候，简直开心。<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//&lt;img class=&quot;xx&quot; title=&quot;xx&quot; alt=&quot;xx&quot; onerror=&quot;img_error(this);&quot; src=&quot;http://ww2.sinaimg.cn/bmiddle/xxx.jpg&quot;&gt;</div><div class="line">//目标是img标签中的src图片地址</div><div class="line"></div><div class="line">Document doc = Jsoup.parse(content);</div><div class="line">Elements elements = doc.select(&quot;img[src$=.jpg]&quot;);</div><div class="line">for (Element src : elements) &#123;</div><div class="line">	Log.d(TAG, src.attr(&quot;abs:src&quot;));</div><div class="line">｝</div></pre></td></tr></table></figure></p>
<h3 id="圆角-点击变色（非监听）Button"><a href="#圆角-点击变色（非监听）Button" class="headerlink" title="圆角+点击变色（非监听）Button"></a>圆角+点击变色（非监听）Button</h3><p>Android中常常使用shape来定义控件的一些显示属性，今天看了一些shape的使用，对shape有了大体的了解，稍作总结：<br>在android的project中新建一个drawable文件夹（此文件夹位于res下），存放定义了shape的<strong>.xml文件，然后在其他xml文件中引用，如，android:background=@drawable/**</strong>.xml<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">shape</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 实心 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#ff9d77"</span>/&gt;</span></div><div class="line"><span class="comment">&lt;!-- 渐变 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">gradient</span></span></div><div class="line"><span class="tag"><span class="attr">android:startColor</span>=<span class="string">"#ff8c00"</span></span></div><div class="line"><span class="tag"><span class="attr">android:endColor</span>=<span class="string">"#FFFFFF"</span></span></div><div class="line"><span class="tag"><span class="attr">android:angle</span>=<span class="string">"270"</span> /&gt;</span></div><div class="line"><span class="comment">&lt;!-- 描边 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">stroke</span></span></div><div class="line"><span class="tag"><span class="attr">android:width</span>=<span class="string">"2dp"</span></span></div><div class="line"><span class="tag"><span class="attr">android:color</span>=<span class="string">"#dcdcdc"</span> /&gt;</span></div><div class="line"><span class="comment">&lt;!-- 圆角 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">corners</span></span></div><div class="line"><span class="tag"><span class="attr">android:radius</span>=<span class="string">"2dp"</span> /&gt;</span></div><div class="line"><span class="comment">&lt;!-- padding：Button里面的文字与Button边界的间隔 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">padding</span></span></div><div class="line"><span class="tag"><span class="attr">android:left</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag"><span class="attr">android:top</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag"><span class="attr">android:right</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag"><span class="attr">android:bottom</span>=<span class="string">"10dp"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>组合起来<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">shape</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 填充的颜色 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@color/loginButtonColor"</span>/&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 设置按钮的四个角为弧形 --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- android:radius 弧形的半径 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"8dp"</span>/&gt;</span></div><div class="line"></div><div class="line">            <span class="comment">&lt;!-- padding：Button里面的文字与Button边界的间隔 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">padding</span> <span class="attr">android:left</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:top</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:right</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:bottom</span>=<span class="string">"10dp"</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">shape</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 填充的颜色 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@color/loginButtonColor"</span>/&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 设置按钮的四个角为弧形 --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- android:radius 弧形的半径 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"8dp"</span>/&gt;</span></div><div class="line"></div><div class="line">            <span class="comment">&lt;!-- padding：Button里面的文字与Button边界的间隔 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">padding</span> <span class="attr">android:left</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:top</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:right</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:bottom</span>=<span class="string">"10dp"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="DP和PX"><a href="#DP和PX" class="headerlink" title="DP和PX"></a>DP和PX</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DensityUtil</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 根据手机的分辨率从 dp 的单位 转成为 px(像素)</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dip2px</span><span class="params">(Context context, <span class="keyword">float</span> dpValue)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> scale = context.getResources().getDisplayMetrics().density;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (dpValue * scale + <span class="number">0.5f</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 根据手机的分辨率从 px(像素) 的单位 转成为 dp</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">px2dip</span><span class="params">(Context context, <span class="keyword">float</span> pxValue)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> scale = context.getResources().getDisplayMetrics().density;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (pxValue / scale + <span class="number">0.5f</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="高斯模糊（配合Glide效果拔群）"><a href="#高斯模糊（配合Glide效果拔群）" class="headerlink" title="高斯模糊（配合Glide效果拔群）"></a>高斯模糊（配合Glide效果拔群）</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlurImageview</span> </span>&#123;</div><div class="line">    <span class="comment">/** 水平方向模糊度 */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">float</span> hRadius = <span class="number">25</span>;</div><div class="line">    <span class="comment">/** 竖直方向模糊度 */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">float</span> vRadius = <span class="number">25</span>;</div><div class="line">    <span class="comment">/** 模糊迭代度 */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> iterations = <span class="number">25</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 图片高斯模糊处理 </span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Drawable <span class="title">BlurImages</span><span class="params">(Bitmap bmp, Context context)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> width = bmp.getWidth();</div><div class="line">        <span class="keyword">int</span> height = bmp.getHeight();</div><div class="line">        <span class="keyword">int</span>[] inPixels = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line">        <span class="keyword">int</span>[] outPixels = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line">        Bitmap bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</div><div class="line">        bmp.getPixels(inPixels, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; iterations; i++) &#123;</div><div class="line">            blur(inPixels, outPixels, width, height, hRadius);</div><div class="line">            blur(outPixels, inPixels, height, width, vRadius);</div><div class="line">        &#125;</div><div class="line">        blurFractional(inPixels, outPixels, width, height, hRadius);</div><div class="line">        blurFractional(outPixels, inPixels, height, width, vRadius);</div><div class="line">        bitmap.setPixels(inPixels, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        Drawable drawable = <span class="keyword">new</span> BitmapDrawable(context.getResources(), bitmap);</div><div class="line">        <span class="keyword">return</span> drawable;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 图片高斯模糊算法</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">blur</span><span class="params">(<span class="keyword">int</span>[] in, <span class="keyword">int</span>[] out, <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">float</span> radius)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> widthMinus1 = width - <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> r = (<span class="keyword">int</span>) radius;</div><div class="line">        <span class="keyword">int</span> tableSize = <span class="number">2</span> * r + <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> divide[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span> * tableSize];</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span> * tableSize; i++) &#123;</div><div class="line">            divide[i] = i / tableSize;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> inIndex = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; height; y++) &#123;</div><div class="line">            <span class="keyword">int</span> outIndex = y;</div><div class="line">            <span class="keyword">int</span> ta = <span class="number">0</span>, tr = <span class="number">0</span>, tg = <span class="number">0</span>, tb = <span class="number">0</span>;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = -r; i &lt;= r; i++) &#123;</div><div class="line">                <span class="keyword">int</span> rgb = in[inIndex + clamp(i, <span class="number">0</span>, width - <span class="number">1</span>)];</div><div class="line">                ta += (rgb &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                tr += (rgb &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                tg += (rgb &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                tb += rgb &amp; <span class="number">0xff</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; width; x++) &#123;</div><div class="line">                out[outIndex] = (divide[ta] &lt;&lt; <span class="number">24</span>) | (divide[tr] &lt;&lt; <span class="number">16</span>) | (divide[tg] &lt;&lt; <span class="number">8</span>) | divide[tb];</div><div class="line"></div><div class="line">                <span class="keyword">int</span> i1 = x + r + <span class="number">1</span>;</div><div class="line">                <span class="keyword">if</span> (i1 &gt; widthMinus1) i1 = widthMinus1;</div><div class="line">                <span class="keyword">int</span> i2 = x - r;</div><div class="line">                <span class="keyword">if</span> (i2 &lt; <span class="number">0</span>) i2 = <span class="number">0</span>;</div><div class="line">                <span class="keyword">int</span> rgb1 = in[inIndex + i1];</div><div class="line">                <span class="keyword">int</span> rgb2 = in[inIndex + i2];</div><div class="line"></div><div class="line">                ta += ((rgb1 &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>) - ((rgb2 &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</div><div class="line">                tr += ((rgb1 &amp; <span class="number">0xff0000</span>) - (rgb2 &amp; <span class="number">0xff0000</span>)) &gt;&gt; <span class="number">16</span>;</div><div class="line">                tg += ((rgb1 &amp; <span class="number">0xff00</span>) - (rgb2 &amp; <span class="number">0xff00</span>)) &gt;&gt; <span class="number">8</span>;</div><div class="line">                tb += (rgb1 &amp; <span class="number">0xff</span>) - (rgb2 &amp; <span class="number">0xff</span>);</div><div class="line">                outIndex += height;</div><div class="line">            &#125;</div><div class="line">            inIndex += width;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 图片高斯模糊算法 </span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">blurFractional</span><span class="params">(<span class="keyword">int</span>[] in, <span class="keyword">int</span>[] out, <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">float</span> radius)</span> </span>&#123;</div><div class="line">        radius -= (<span class="keyword">int</span>) radius;</div><div class="line">        <span class="keyword">float</span> f = <span class="number">1.0f</span> / (<span class="number">1</span> + <span class="number">2</span> * radius);</div><div class="line">        <span class="keyword">int</span> inIndex = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; height; y++) &#123;</div><div class="line">            <span class="keyword">int</span> outIndex = y;</div><div class="line"></div><div class="line">            out[outIndex] = in[<span class="number">0</span>];</div><div class="line">            outIndex += height;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; width - <span class="number">1</span>; x++) &#123;</div><div class="line">                <span class="keyword">int</span> i = inIndex + x;</div><div class="line">                <span class="keyword">int</span> rgb1 = in[i - <span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> rgb2 = in[i];</div><div class="line">                <span class="keyword">int</span> rgb3 = in[i + <span class="number">1</span>];</div><div class="line"></div><div class="line">                <span class="keyword">int</span> a1 = (rgb1 &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> r1 = (rgb1 &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> g1 = (rgb1 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> b1 = rgb1 &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> a2 = (rgb2 &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> r2 = (rgb2 &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> g2 = (rgb2 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> b2 = rgb2 &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> a3 = (rgb3 &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> r3 = (rgb3 &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> g3 = (rgb3 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</div><div class="line">                <span class="keyword">int</span> b3 = rgb3 &amp; <span class="number">0xff</span>;</div><div class="line">                a1 = a2 + (<span class="keyword">int</span>) ((a1 + a3) * radius);</div><div class="line">                r1 = r2 + (<span class="keyword">int</span>) ((r1 + r3) * radius);</div><div class="line">                g1 = g2 + (<span class="keyword">int</span>) ((g1 + g3) * radius);</div><div class="line">                b1 = b2 + (<span class="keyword">int</span>) ((b1 + b3) * radius);</div><div class="line">                a1 *= f;</div><div class="line">                r1 *= f;</div><div class="line">                g1 *= f;</div><div class="line">                b1 *= f;</div><div class="line">                out[outIndex] = (a1 &lt;&lt; <span class="number">24</span>) | (r1 &lt;&lt; <span class="number">16</span>) | (g1 &lt;&lt; <span class="number">8</span>) | b1;</div><div class="line">                outIndex += height;</div><div class="line">            &#125;</div><div class="line">            out[outIndex] = in[width - <span class="number">1</span>];</div><div class="line">            inIndex += width;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">clamp</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (x &lt; a) ? a : (x &gt; b) ? b : x;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a>如何使用？</h4><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">      Glide.with(MainActivity.<span class="keyword">this</span>)</div><div class="line">.load(R.drawable.back)</div><div class="line">.asBitmap()</div><div class="line">.into(<span class="keyword">new</span> SimpleTarget&lt;Bitmap&gt;() &#123;</div><div class="line">          <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(Bitmap resource, GlideAnimation&lt;? <span class="keyword">super</span> Bitmap&gt; glideAnimation)</span> </span>&#123;</div><div class="line">              mImageView.setBackground(BlurImageview.BlurImages(resource, MainActivity.<span class="keyword">this</span>));</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure></div></article></div></section><footer><div class="paginator"><a href="/2015/12/26/获取一个有JS加载的网页信息/" class="prev">上一篇</a><a href="/2015/11/29/从一个实例简单学习RecyclerView/" class="next">下一篇</a></div><div data-thread-key="2015/12/17/【自整理】Android开发中的Tips/" data-title="【自整理】Android开发中的Tips" data-url="http://imxie.cc/2015/12/17/【自整理】Android开发中的Tips/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"imxie"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://www.imxie.cc/js/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2019 做一件值得的事.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80145821-1",'auto');ga('send','pageview');</script></body></html>