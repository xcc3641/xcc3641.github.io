<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 就看天气V2.0-RxAndroid+Retrofit+Glide+Matrial Design Weather App · IM XIE</title><meta name="description" content="就看天气V2.0-RxAndroid+Retrofit+Glide+Matrial Design Weather App - 谢三弟"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://imxie.cc/atom.xml" title="IM XIE"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/xcc3641" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/WebLab/" target="_self" class="nav-list-link">WEBLAB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">就看天气V2.0-RxAndroid+Retrofit+Glide+Matrial Design Weather App</h1><div class="post-info">2016年2月21日</div><div class="post-content"><p>最初上线是在2015年10月，是自己第一个较为成熟的应用，开发完之后刚好答了知乎这篇<a href="https://www.zhihu.com/question/26417244/answer/70193822" target="_blank" rel="external">如何自学Android编程</a></p>
<p>但是因为代码确实写的很烂，所以决定全部重构代码全新风格的展示就看天气Ver2.0.</p>
<p>当然自己也在学习之中，如果发现有任何问题和建议，随时欢迎Email或者开Issues</p>
<ul>
<li><strong>开源不易，希望能给个Star鼓励</strong> </li>
<li>项目地址：<a href="https://github.com/xcc3641/SeeWeather" target="_blank" rel="external">https://github.com/xcc3641/SeeWeather</a></li>
<li>项目主页发布issue: <a href="https://github.com/xcc3641/SeeWeather/issues" target="_blank" rel="external">https://github.com/xcc3641/SeeWeather/issues</a></li>
<li>本项目为开源项目,技术交流可以通过邮箱联系: Hugo3641@gmail.com</li>
</ul>
<a id="more"></a>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>就看天气——是一款遵循<strong>Material Design</strong>风格的只看天气的APP。无流氓权限，无自启，xxx，用最少的权限做最优的体验。</p>
<ul>
<li>卡片展现（当前天气情况，未来几小时天气情况，生活建议，一周七天概况）</li>
<li>补全城市（第一版本因为自己偷懒所以城市有缺陷对不起各位）</li>
<li>自动定位</li>
<li>缓存数据，减少网络请求，保证离线查看</li>
<li>内置两套图标（设置里更改）</li>
<li>彩蛋（自动夜间状态）</li>
</ul>
<hr>
<p>权限说明</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;!--用于进行网络定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;/&gt;</div><div class="line">&lt;!--用于访问GPS定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;</div><div class="line">&lt;!--获取运营商信息，用于支持提供运营商信息相关的接口--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;</div><div class="line">&lt;!--用于访问wifi网络信息，wifi信息会用于进行网络定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;/&gt;</div><div class="line">&lt;!--这个权限用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot;/&gt;</div><div class="line">&lt;!--用于访问网络，网络定位需要上网--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</div><div class="line">&lt;!--用于读取手机当前的状态--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;/&gt;</div><div class="line">&lt;!--写入扩展存储，向扩展卡写入数据，用于写入缓存定位数据--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot;/&gt;</div></pre></td></tr></table></figure>
<h3 id="版本更新-amp-amp-下载地址"><a href="#版本更新-amp-amp-下载地址" class="headerlink" title="版本更新&amp;&amp;下载地址"></a>版本更新&amp;&amp;下载地址</h3><p>Fir.im: <a href="http://fir.im/seeWeather" target="_blank" rel="external">http://fir.im/seeWeather</a></p>
<p>豌豆荚：<a href="http://www.wandoujia.com/apps/com.xiecc.seeWeather" target="_blank" rel="external">http://www.wandoujia.com/apps/com.xiecc.seeWeather</a></p>
<p>魅族应用中心： <a href="http://developer.meizu.com/console/apps/detail/6530883" target="_blank" rel="external">http://developer.meizu.com/console/apps/detail/6530883</a></p>
<p>酷安市场：<a href="http://www.coolapk.com/apk/com.xiecc.seeWeather" target="_blank" rel="external">http://www.coolapk.com/apk/com.xiecc.seeWeather</a></p>
<p>v2.0</p>
<ul>
<li>重构代码，全新UI，升级体验</li>
<li>就看天气——是一款遵循<strong>Material Design</strong>风格的只看天气的APP。无流氓权限，无自启，xxx，用最少的权限做最优的体验。</li>
<li>卡片展现（当前天气情况，未来几小时天气情况，生活建议，一周七天概况）</li>
<li>彩蛋（自动夜间状态）</li>
<li>补全城市（第一版本因为自己偷懒所以城市有缺陷对不起各位）</li>
<li>缓存数据，减少网络请求，保证离线查看</li>
<li>内置两套图标（设置里更改）</li>
</ul>
<p>v1.1</p>
<ul>
<li>加固</li>
<li>兼容更多系统版本</li>
</ul>
<p>v1.0</p>
<ul>
<li>就看天气V1.0</li>
<li>@图片和信息来源于网络，侵权删</li>
</ul>
<h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><p>这学期有点忙，需要花时间巩固基础，准备面试，但是自己还是会抽空尽快做出这些功能的，谢谢大家理解和支持</p>
<ul>
<li>[ ] 桌面小部件</li>
<li>[ ] 通知栏提醒</li>
<li>[ ] 更好，更多的天气ICONS</li>
<li>[ ] 管理城市（多城市选择）</li>
<li>[x] 自动定位</li>
<li>[ ] 自由定制的Item界面</li>
</ul>
<hr>
<h3 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h3><h4 id="公开-API"><a href="#公开-API" class="headerlink" title="公开 API"></a>公开 API</h4><p>天气数据来源于：和风天气<br>城市信息来源于：CSDN<br>地理定位服务： 高德地图</p>
<h4 id="开源技术"><a href="#开源技术" class="headerlink" title="开源技术"></a>开源技术</h4><ol>
<li><a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">Rxjava</a></li>
<li><a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="external">RxAndroid</a></li>
<li><a href="https://github.com/square/retrofit" target="_blank" rel="external">Retrofit</a></li>
<li><a href="https://github.com/bumptech/glide" target="_blank" rel="external">GLide</a></li>
<li><a href="https://github.com/yangfuhai/ASimpleCache" target="_blank" rel="external">ASimpleCache</a></li>
</ol>
<h4 id="简单介绍代码"><a href="#简单介绍代码" class="headerlink" title="简单介绍代码"></a>简单介绍代码</h4><h5 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h5><p>就看天气的网络部分的支持是用<code>RxJava+RxAndroid+Retrofit+Gson</code>再加上<code>ACache</code>缓存<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/**</div><div class="line">  * &lt;p/&gt;</div><div class="line">  * 首先从本地缓存获取数据</div><div class="line">  * if 有</div><div class="line">  * 更新UI</div><div class="line">  * else</div><div class="line">  * 直接进行网络请求，更新UI并保存在本地</div><div class="line">  */</div><div class="line"> private void fetchData() &#123;</div><div class="line">     observer = new Observer&lt;Weather&gt;() &#123;</div><div class="line">                     //节约篇幅，已省略</div><div class="line">                     ...</div><div class="line">     &#125;;</div><div class="line"></div><div class="line">     fetchDataByCache(observer);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> /**</div><div class="line">  * 从本地获取</div><div class="line">  */</div><div class="line"> private void fetchDataByCache(Observer&lt;Weather&gt; observer) &#123;</div><div class="line">     Weather weather = null;</div><div class="line">     try &#123;</div><div class="line">         weather = (Weather) aCache.getAsObject(&quot;WeatherData&quot;);</div><div class="line">     &#125; catch (Exception e) &#123;</div><div class="line">         Log.e(TAG, e.toString());</div><div class="line">     &#125;</div><div class="line">     if (weather != null) &#123;</div><div class="line">     //distinct去重</div><div class="line">         Observable.just(weather).distinct().subscribe(observer);</div><div class="line">     &#125; else &#123;</div><div class="line">         fetchDataByNetWork(observer);</div><div class="line">     &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> /**</div><div class="line">  * 从网络获取</div><div class="line">  */</div><div class="line"> private void fetchDataByNetWork(Observer&lt;Weather&gt; observer) &#123;</div><div class="line">     String cityName = mSetting.getString(Setting.CITY_NAME, &quot;重庆&quot;);</div><div class="line">     RetrofitSingleton.getApiService(this)</div><div class="line">                      .mWeatherAPI(cityName, key)</div><div class="line">                      .subscribeOn(Schedulers.io())</div><div class="line">                      .observeOn(AndroidSchedulers.mainThread())</div><div class="line">			////节约篇幅，已省略</div><div class="line">                     ...</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h5 id="RecycerVIew展示"><a href="#RecycerVIew展示" class="headerlink" title="RecycerVIew展示"></a>RecycerVIew展示</h5><p>就像洪洋说的一样</p>
<blockquote>
<p>整体上看RecyclerView架构，提供了一种插拔式的体验，高度的解耦，异常的灵活，通过设置它提供的不同LayoutManager，ItemDecoration , ItemAnimator实现令人瞠目的效果。</p>
</blockquote>
<p>该项目中用到RecyclerView中级的用法是根据itemType展示不同的布局，这就是主页核心的代码了。<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@Override public int getItemViewType(int position) &#123;</div><div class="line">        if (position == TYPE_ONE) &#123;</div><div class="line">        //标识</div><div class="line">			...</div><div class="line">        &#125;</div><div class="line">        return super.getItemViewType(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">@Override public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">        if (viewType == TYPE_ONE) &#123;</div><div class="line">        //绑定</div><div class="line"> 			...</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">@Override public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) &#123;</div><div class="line"></div><div class="line">        if (holder instanceof NowWeatherViewHolder) &#123;</div><div class="line">        //更新布局</div><div class="line">        ....</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h3><p><img src="http://xcc3641.qiniudn.com/app-%E5%B0%B1%E7%9C%8B%E5%A4%A9%E6%B0%94-%E9%97%AA%E5%B1%8F.png" alt=""><br><img src="http://xcc3641.qiniudn.com/app-%E5%B0%B1%E7%9C%8B%E5%A4%A9%E6%B0%94-%E7%99%BD%E5%A4%A9%E6%A8%A1%E5%BC%8F.png" alt=""><br><img src="http://xcc3641.qiniudn.com/app-%E5%B0%B1%E7%9C%8B%E5%A4%A9%E6%B0%94-%E5%A4%9C%E6%99%9A%E6%A8%A1%E5%BC%8F.png" alt=""></p>
<h3 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h3><p>感谢开源，学习到了前辈们优秀的代码</p>
<ul>
<li><a href="https://github.com/hongyangAndroid" target="_blank" rel="external">@张鸿洋</a></li>
<li><a href="https://github.com/rengwuxian" target="_blank" rel="external">@扔物线</a></li>
<li><a href="https://github.com/drakeet" target="_blank" rel="external">@drakeet</a></li>
<li><a href="https://github.com/daimajia" target="_blank" rel="external">@代码家</a></li>
<li><a href="https://github.com/AlanCheen" target="_blank" rel="external">@程序亦非猿</a></li>
<li><a href="https://github.com/SmartDengg" target="_blank" rel="external">@小鄧子</a></li>
<li><a href="https://github.com/Jude95" target="_blank" rel="external">@Jude95</a></li>
</ul>
<p>特别感谢<strong>简书猿圈</strong></p>
<h3 id="关于作者"><a href="#关于作者" class="headerlink" title="关于作者"></a>关于作者</h3><p><img src="http://xcc3641.qiniudn.com/app-%E5%A4%B4%E5%83%8F-1.jpeg" alt=""></p>
<p>简书：<a href="http://www.jianshu.com/users/3372b4a3b9e5/latest_articles" target="_blank" rel="external">http://www.jianshu.com/users/3372b4a3b9e5/latest_articles</a></p>
<p>知乎：<a href="https://www.zhihu.com/people/xcc3641.github.io" target="_blank" rel="external">https://www.zhihu.com/people/xcc3641.github.io</a></p>
<p>微博：<a href="http://weibo.com/xcc3641" target="_blank" rel="external">http://weibo.com/xcc3641</a></p>
<p>个人博客： <a href="http://IMXIE.CC">http://IMXIE.CC</a></p>
<h3 id="请我喝杯咖啡"><a href="#请我喝杯咖啡" class="headerlink" title="请我喝杯咖啡"></a>请我喝杯咖啡</h3><hr>
<p><img src="http://xcc3641.qiniudn.com/app-%E6%94%AF%E4%BB%98%E5%AE%9D.jpg" alt=""></p>
<hr>
<h3 id="LICENSE"><a href="#LICENSE" class="headerlink" title="LICENSE"></a>LICENSE</h3><p>Copyright 2016 HugoXie  Licensed under the Apache License, Version 2.0 (the \”License\”)<br>        you may not use this file except in compliance with the License. You may obtain a copy of the License at <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="external">http://www.apache.org/licenses/LICENSE-2.0</a><br>        Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \”AS IS\” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p>图片来源于网络，版权属于原作者。</p></div></article></div></section><footer><div class="paginator"></div><div data-thread-key="hide/就看天气V2-0.html" data-title="就看天气V2.0-RxAndroid+Retrofit+Glide+Matrial Design Weather App" data-url="http://imxie.cc/hide/就看天气V2-0.html" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"imxie"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://www.imxie.cc/js/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2019 做一件值得的事.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80145821-1",'auto');ga('send','pageview');</script></body></html>