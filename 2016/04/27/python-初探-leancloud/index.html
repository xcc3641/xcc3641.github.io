<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Python 初探 leancloud · IM XIE</title><meta name="description" content="Python 初探 leancloud - 谢三弟"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://imxie.cc/atom.xml" title="IM XIE"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/xcc3641" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/WebLab/" target="_self" class="nav-list-link">WEBLAB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Python 初探 leancloud</h1><div class="post-info">2016年4月27日</div><div class="post-content"><p>很久没有写 Python 了，自己阿里云的服务器也忘记续费而被释放。当初用的东西有点重，Ubuntu 下定时任务执行一个 Python 爬虫，将爬取到的数据写入 MySQL ，接口是 Java 那一套 tomcat 。</p>
<p>所以准备写个系列，从简单的使用 leancloud 的存储到 leancloud 的云引擎。</p>
<a id="more"></a>
<h3 id="0x01-准备"><a href="#0x01-准备" class="headerlink" title="0x01 准备"></a>0x01 准备</h3><h5 id="安装-virtualenv"><a href="#安装-virtualenv" class="headerlink" title="安装 virtualenv"></a>安装 virtualenv</h5><p>使用 <a href="https://virtualenv.pypa.io/" target="_blank" rel="external">virtualenv</a> 可以创建一个与系统隔离的 Python 环境，在其中安装的第三方模块版本不会与系统自带的或者其他项目中的模块冲突。</p>
<p>安装 <code>virtualenv</code> &gt; <code>pip install virtualenv</code></p>
<h5 id="创建虚拟并激活虚拟环境"><a href="#创建虚拟并激活虚拟环境" class="headerlink" title="创建虚拟并激活虚拟环境"></a>创建虚拟并激活虚拟环境</h5><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line">cd yourProject</div><div class="line">virtualenv ENV(自取)</div><div class="line">source bin/activate</div></pre></td></tr></table></figure>
<p>命令行上出现 (ENV) 表示是在当前虚拟环境下</p>
<p>使用 <code>deactivate</code> 可以退出虚拟环境</p>
<h5 id="安装-leancloud-sdk"><a href="#安装-leancloud-sdk" class="headerlink" title="安装 leancloud-sdk"></a>安装 leancloud-sdk</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pip install leancloud-sdk</div></pre></td></tr></table></figure>
<h3 id="0x02-数据存储"><a href="#0x02-数据存储" class="headerlink" title="0x02 数据存储"></a>0x02 数据存储</h3><h5 id="初始化-leancloud"><a href="#初始化-leancloud" class="headerlink" title="初始化 leancloud"></a>初始化 leancloud</h5><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> leancloud</div><div class="line"><span class="keyword">from</span> leancloud <span class="keyword">import</span> Object</div><div class="line">leancloud.init(<span class="string">'id'</span>, <span class="string">'key'</span>)</div></pre></td></tr></table></figure>
<p>id 和 key 在 <strong>项目</strong> &gt; <strong>设置</strong> &gt;<strong>应用 Key</strong> 中查看。</p>
<h5 id="存储数据"><a href="#存储数据" class="headerlink" title="存储数据"></a>存储数据</h5><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GirlImage</span><span class="params">(Object)</span>:</span></div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">src</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="comment"># 可以使用property装饰器，方便获取属性</span></div><div class="line">        <span class="keyword">return</span> self.get(<span class="string">'src'</span>)</div><div class="line"></div><div class="line"><span class="meta">    @src.setter</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">src</span><span class="params">(self, value)</span>:</span></div><div class="line">        <span class="comment"># 同样的，可以给对象的score增加setter</span></div><div class="line">        <span class="keyword">return</span> self.set(<span class="string">'src'</span>, value)</div><div class="line"></div><div class="line"></div><div class="line">girl_image = GirlImage()</div><div class="line">girl_image.set(<span class="string">'src'</span>,<span class="string">"地址"</span>)</div><div class="line">girl_image.save()</div></pre></td></tr></table></figure>
<p>执行完之后，你会在项目<strong>存储</strong>&gt;<strong>数据</strong>下看到已经新建好了 GirlImage 这个表并且保存了一条<code>src = 地址</code> 的数据。</p>
<h5 id="爬取存储"><a href="#爬取存储" class="headerlink" title="爬取存储"></a>爬取存储</h5><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">http</span><span class="params">()</span>:</span></div><div class="line">    page = <span class="number">1</span></div><div class="line">    url = <span class="string">'http://www.dbmeinv.com/dbgroup/current.htm?gid=haixiuzu&amp;pager_offset='</span> + str(page)</div><div class="line">    headers = &#123;<span class="string">'content-type'</span>: <span class="string">'text/html;charset=UTF-8'</span>,</div><div class="line">               <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.87 Safari/537.36 QQBrowser/9.2.4907.400'</span>&#125;</div><div class="line">    content = requests.post(url, headers).text</div><div class="line">    images_codes = re.findall(<span class="string">'&lt;img class="height_min" .+? src="(.*?)"'</span>, content, re.S)</div><div class="line"></div><div class="line">    <span class="comment"># print images_codes</span></div><div class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> images_codes:</div><div class="line">        girl_image = GirlImage()</div><div class="line">        girl_image.set(<span class="string">"src"</span>, url)</div><div class="line">        girl_image.save()</div></pre></td></tr></table></figure>
<p>一个简单的小爬虫，爬了该网站一页图片，20条存入 leancloud 。</p>
<h5 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h5><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"></div><div class="line">query = Query(GirlImage)  <span class="comment"># 这里也可以直接传递一个 Class 名字的字符串作为构造参数</span></div><div class="line">query.select(<span class="string">'src'</span>)</div><div class="line">reslut = query.find()</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> reslut:</div><div class="line">    print(i.get(<span class="string">'src'</span>))</div></pre></td></tr></table></figure>
<h3 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h3><p>初探就先这样结束了，我这里只是运用了很简单的功能。</p>
<p>不过爬取&gt;存储&gt;查询，都写全了。</p>
<p>后期我会再探 leancloud 写增量爬取加 leancloud 的云引擎。</p>
<h5 id="更多请参考"><a href="#更多请参考" class="headerlink" title="更多请参考"></a>更多请参考</h5><p><a href="https://leancloud.cn/docs/python_guide.html#对象" target="_blank" rel="external">leancloud 对象操作</a></p>
<p><a href="https://leancloud.cn/docs/python_guide.html#查询" target="_blank" rel="external">leancloud 查询操作</a></p></div></article></div></section><footer><div class="paginator"><a href="/2016/05/07/Android-Studio-Mac-闪屏解决方案/" class="prev">上一篇</a><a href="/2016/03/12/SharedPreferences-Util/" class="next">下一篇</a></div><div data-thread-key="2016/04/27/python-初探-leancloud/" data-title="Python 初探 leancloud" data-url="http://imxie.cc/2016/04/27/python-初探-leancloud/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"imxie"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://www.imxie.cc/js/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2019 做一件值得的事.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80145821-1",'auto');ga('send','pageview');</script></body></html>